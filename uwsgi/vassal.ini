{% set opbeat = settings.get('opbeat', {}) -%}
{% set test = settings.get('test', {}) -%}
{% extends "uwsgi/vassal_base.ini" -%}
{% block app -%}
chdir = /home/web/repo/project/{{ site }}/live/
logto = /home/web/repo/uwsgi/log/{{ site }}.log
log-backupname = /home/web/repo/uwsgi/log/{{ site }}.log.old
; 100 megs, then rotate
log-maxsize = 100000000
master = true
module = project.wsgi
plugins = stats_pusher_statsd,python3
pythonpath = /home/web/repo/project/{{ site }}/live/
socket = 127.0.0.1:{{ settings['uwsgi_port'] }}
virtualenv = /home/web/repo/project/{{ site }}/live/venv
{% if testing and test -%}
stats-push = statsd:127.0.0.1:8125,{{ site }}_test
{% else -%}
stats-push = statsd:127.0.0.1:8125,{{ site }}
{% endif -%}
{% if opbeat -%}
env = OPBEAT_APP_ID={{ opbeat['app_id'] }}
env = OPBEAT_ORGANIZATION_ID={{ opbeat['organization_id'] }}
env = OPBEAT_SECRET_TOKEN={{ opbeat['secret_token'] }}
{% endif -%}
{% endblock app -%}
